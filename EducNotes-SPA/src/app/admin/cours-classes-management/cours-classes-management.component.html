
<nz-tabset [nzTabPosition]="'left'">
    <nz-tab nzTitle="CLASSES">
        <button nz-button nzType="primary" (click)="addClass()" style="margin:5px;" >ajouter</button>

          <div class="form-inline" >
              <label for="levelId">Niveau:</label>
              <nz-select name="levelId" id="levelId"  style="width: 200px;margin-left:2px;" nzShowSearch 
              nzAllowClear nzPlaceHolder="Choisir le niveau" [(ngModel)]="levelId">
              <nz-option *ngFor="let level of levelsForSearch" nzValue="{{level.id}}" nzLabel="{{level.name}}"></nz-option>
              </nz-select>
                
                <button nz-button nzType="default" [disabled]='!levelId'  (click)="searchClasses()" style="margin-left:2px;" >rechercher</button>
         
            </div>
            <div class="row mt-5" *ngIf="showSearch">
              <div *ngIf="noResult">
                  <h6>{{noResult}}</h6>
              </div>
             <div>
               <nz-table #nzTable [nzData]="classes" [nzPageSize]="50" [nzBordered]="true" [nzSize]="'large'" *ngIf="classes.length>0">
                    <thead>
                      <tr>
                        <th nzShowExpand></th>
                        <th>Nom</th>
                        <th>Effectif</th>
                        <th>Prof principal</th>
                        <th>option</th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-template ngFor let-data [ngForOf]="nzTable.data">
                        <tr >
                          <td nzShowExpand [(nzExpand)]="data.expand" ></td>
                        
                              <td>{{data.class.name}}</td>
                              <td>{{data.studentsNumber}}</td>
                          <td>
                            <span *ngIf="data.mainTeacher===null">N/A</span>
                             <span  *ngIf="data.mainTeacher!=null">{{data.mainTeacher.lastName}} {{data.mainTeacher.firstName}}</span>
                             <button nz-button [nzSize]="'small'" nzType="dashed" nzShape="circle" (click)="ppseting(data.class.id, data.mainTacher.Id)"><i class="fa fa-pencil"></i></button>
                          </td>
                          <td>
                               <button nz-button [nzSize]="'small'" nzType="default" (click)="modifierClass(data)">editer</button> 
                               <!-- <button  [disabled]="data.courses[0].id!==null" nz-button [nzSize]="'small'" nzType="default" (click)="deleteClass(data.class.id)">supprimer</button>  -->

                          </td>
                        </tr>
                        <tr [nzExpand]="data.expand">
                          <td></td>
                          <td colspan="4">
                            <div class="form-inline">
                              <b>{{data.courses.length}} cours : </b>  <label *ngFor="let cours of data.courses">{{cours.name}}&nbsp;</label>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </tbody>
                  </nz-table>
                
             </div>
               

            </div>
      
       
    </nz-tab>
    <nz-tab nzTitle="COURS">
   
      <div class="card">
          <form nz-form [nzLayout]="'inline'" [formGroup]="courseForm" (ngSubmit)="saveNewCourse()" class="ml-3">
              <nz-form-item>
                <nz-form-control>
                  <nz-input-group >
                    <input formControlName="name" nz-input placeholder="nom du cours">
                  </nz-input-group>
               </nz-form-control>
            
                <nz-form-control>
                  <button nz-button nzType="primary" [disabled]="!courseForm.valid" class="ml-3">AJOUTER</button>
                </nz-form-control>
              </nz-form-item>
            </form>
      </div>

      <div class="card">
          <nz-table #nzTable [nzData]="allCourses" [nzShowPagination]="true" [nzPageSize]="15" [nzBordered]="true" [nzSize]="'small'" >
              <thead>
                <tr>
                  <th nzShowExpand></th>
                  <th>Cours</th>
                  <th>Nombre de Prof</th>
                  <th>Nombre de classe</th>
                  <th>Nombre d'elève</th>
                  <th>option</th>
                </tr>
              </thead>
              <tbody>
                <ng-template ngFor let-data [ngForOf]="nzTable.data">
                  <tr [ngStyle]="data.type?{'font-style': 'italic'} : {}">
                    <td nzShowExpand [(nzExpand)]="data.expand" ></td>
                  
                        <td>
                          <p *ngIf="!data.visible">{{data.course.name}}</p>

                         <div class="form-inline" *ngIf="data.visible">
                            <form nz-form [nzLayout]="'inline'">
                                <nz-form-item>
                                  <nz-form-control>
                                    <nz-input-group >
                                      <input nz-input  name ="coursname" [(ngModel)]="coursName">
                                    </nz-input-group>
                                 </nz-form-control>
                              
                                  <nz-form-control>
                                      <button nz-button nzType="default" class="ml-2" (click)="cancelCourseEditing()" title="annuler"><i class="fa fa-ban"></i></button>
                                      <button nz-button nzType="primary" class="ml-2" (click)="saveCourseEdition()" ><i class="fa fa-floppy-o" title="enregistrer"></i></button>
                                  </nz-form-control>
                                </nz-form-item>
                              </form>
   </div>
                        </td>
                        <td>{{data.teachers.length}}</td>
                        <td>{{data.classes.length}}</td>  
                        <td>{{data.studentsNumber}}</td>
                  
                    <td>
                         <button nz-button [nzSize]="'small'" nzType="default" (click)="modifierCours(data.course.id)">editer</button> 
                         <!-- <button  [disabled]="data.courses[0].id!==null" nz-button [nzSize]="'small'" nzType="default" (click)="deleteClass(data.class.id)">supprimer</button>  -->

                    </td>
                  </tr>
                  <tr [nzExpand]="data.expand">
                    <td></td>
                    <td colspan="4">
                      
                        <h3 class="text-monospace" *ngIf="data.classes.length==0">Aucune classe enregistrée pour ce cours</h3>

                        <div class="card " *ngIf="data.classes.length>0">
                            <h3 class="text-monospace">listes des classes</h3>
                            <div class="row col-sm-12 mb-2">
                               <div class="card col-sm-2  pt-3" *ngFor="let class of data.classes">
                                   <div class="alert alert-dark " role="alert">
                                      {{class.name}}
                                     </div>
                               </div>
                            </div>
                        </div>

                        <h3 class="text-monospace" *ngIf="data.teachers.length==0">Aucun professeur enregistré pour ce cours</h3>
                   
                    <div class="card mt-3" *ngIf="data.teachers.length>0">
                        <h3 class="text-monospace">listes des professeurs</h3>
                        <nz-list [nzDataSource]="data.teachers" [nzRenderItem]="item" [nzItemLayout]="'horizontal'">
                            <ng-template #item let-item>
                              <nz-list-item>
                                <nz-list-item-meta
                                  [nzTitle]="nzTitle"
                                  nzAvatar="{{item.photoUrl || '../../assets/user.png'}}"
                                  nzDescription=" : {{item.age}} ans. Contact(s): {{item.phoneNumber}} {{item.secondPhoneNumber}}. Email: {{item.email}} ">
                                  <ng-template #nzTitle>
                                    <a href="https://ng.ant.design" [routerLink]="['/members/', item.id]">{{item.lastName}} {{item.firstName}}</a>
                                  </ng-template>
                                </nz-list-item-meta>
                              </nz-list-item>
                            </ng-template>
                          </nz-list>  
                    </div>                      
                      <!-- <div class="form-inline">
                        <b>{{data.courses.length}} cours : </b>  <label *ngFor="let cours of data.courses">{{cours.name}}&nbsp;</label>
                      </div> -->
                    </td>
                  </tr>
                </ng-template>
              </tbody>
            </nz-table>
      </div>
   
    </nz-tab>
  
  </nz-tabset>


  <nz-drawer [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom':'53px' }"[nzMaskClosable]="false"
   [nzWidth]="720" [nzVisible]="visible" nzTitle="{{drawerTitle}}" (nzOnClose)="close()">
      <div *ngIf="classAdding==true">
          <form nz-form [formGroup]="classForm" (ngSubmit)="saveClass()">
              <nz-alert nzType="error" nzCloseable
              nzMessage="{{errorMessage}}" *ngIf="errorMessage"
              >
            </nz-alert>

              <nz-alert nzType="info" nzMessage="Le champ nom n'est pas obligatoire. Il sera automatiquement renseigné à partir de son niveau et de son numero"></nz-alert>
              <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="name">Nom</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input formControlName="name" id="name">
                  </nz-form-control>
               </nz-form-item>

               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="levelId">Niveau</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <nz-select name="classlevelId" id="classlevelId"  style="width: 100%" nzShowSearch 
                      nzAllowClear nzPlaceHolder="Choisir le niveau" formControlName="levelId">
                      <nz-option *ngFor="let level of levels" nzValue="{{level.id}}" nzLabel="{{level.name}}"></nz-option>
                      </nz-select>
                    <nz-form-explain *ngIf="classForm.get('levelId').dirty && classForm.get('levelId').errors">Veuillez choisir le niveau</nz-form-explain>
                  </nz-form-control>
               </nz-form-item>

               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="suffixe">Suffixe</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <nz-select name="suffixe" id="suffixe"  style="width: 100%" nzShowSearch 
                          nzAllowClear nzPlaceHolder="Choisir le niveau" formControlName="suffixe">
                          <nz-option *ngFor="let item of suffixes" nzValue="{{item.id}}" nzLabel="{{item.name}}"></nz-option>
                          </nz-select>
                  </nz-form-control>
               </nz-form-item>
               
               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="number">Nombre</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <nz-input-number name="number" id="number" formControlName="number" [nzMin]="1" [nzMax]="100" [nzStep]="1"></nz-input-number>
                  </nz-form-control>
               </nz-form-item>

             
               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="courseIds">Cours </nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <nz-select style="width: 100%" formControlName="courseIds"  [nzSize]="'default'" nzMode="tags" nzPlaceHolder="Choisir ses cours">
                          <nz-option *ngFor="let course of courses" [nzLabel]="course.name" [nzValue]="course.id"></nz-option>
                      </nz-select>
                  </nz-form-control>
               </nz-form-item>
  
            </form>
        
            <div class="footer" style="margin-left:10px;">
                <button type="submit" [disabled]="!classForm.valid || submitText!='enregistrer'" (click)="saveClass()" class="ant-btn ant-btn-primary"><span>{{submitText}}</span></button>
                <button type="button" (click)="close()" class="ant-btn" style="margin-right: 8px;"><span>annuler</span></button>
            </div>
      </div>
      <div *ngIf="classEditing==true">

          <form  nz-form [formGroup]="editClassForm" (ngSubmit)="saveClassChange()">
               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24"  nzFor="name">Nom</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input  formControlName="name" id="name" name="id">
                  </nz-form-control>
               </nz-form-item>

               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="l">Niveau</nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <!-- <nz-select name="l" id="l"  style="width: 100%" nzShowSearch 
                      nzAllowClear nzPlaceHolder="Choisir le niveau" [(ngModel)]="selectedClass.class.classLevelId">
                      <nz-option *ngFor="let level of levels" nzValue="{{level.id}}" nzLabel="{{level.name}}"></nz-option>
                      </nz-select> -->
                      <select name="jj" id="jj"  formControlName="classLevelId" class="form-control"  nzShowSearch>
                        <option *ngFor="let item of levels" [value]="item.id">{{item.name}}</option>
                      </select>
                  </nz-form-control>
               </nz-form-item>

                            
               <nz-form-item>
                  <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="courseIds">Cours </nz-form-label>
                  <nz-form-control [nzSm]="14" [nzXs]="24">
                      <nz-select style="width: 100%"  formControlName="courseIds" [nzSize]="'default'"
                      name="courses" id="courses" nzMode="tags" nzPlaceHolder="Choisir ses cours">
                          <nz-option *ngFor="let course of courses" [nzLabel]="course.name" [nzValue]="course.id"></nz-option>
                      </nz-select>
                  </nz-form-control>
               </nz-form-item>
  
            </form>
        
            <div class="footer" style="margin-left:10px;">
                <button type="submit" [disabled]="!editClassForm.valid || submitText!='enregistrer'" (click)="saveClassChange()" class="ant-btn ant-btn-primary"><span>{{submitText}}</span></button>
                <button type="button" (click)="close()" class="ant-btn" style="margin-right: 8px;"><span>annuler</span></button>
            </div>
        
      </div>
     
      
    </nz-drawer>







